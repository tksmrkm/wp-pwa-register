!function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(2),o=function(e){return e&&e.__esModule?e:{default:e}}(s);new(function(){function e(){i(this,e),this.logger=new o.default(WP_REGISTER_SERVICE_WORKER.webroot+"/api/log?method=post"),this.messaging=firebase.messaging(),this.auth=firebase.auth(),this.refresh=!1,window.addEventListener("load",this.onload.bind(this))}return r(e,[{key:"onload",value:function(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/pwa-service-worker.js").then(this.register.bind(this))}},{key:"register",value:function(e){this.messaging.useServiceWorker(e);var t=this.messaging.getNotificationPermission_();this.permission=t,"default"===t?this.requestPermission():"granted"===t&&this.messaging.onTokenRefresh(this.refreshToken.bind(this))}},{key:"requestPermission",value:function(){this.messaging.requestPermission().then(this.getToken.bind(this)).catch(this.error.bind(this))}},{key:"refreshToken",value:function(){return this.refresh=!0,this.logger.logging({msg:"will refresh token"}),this.getToken()}},{key:"getToken",value:function(){return this.messaging.getToken().then(this.setToken.bind(this)).catch(this.error.bind(this))}},{key:"setToken",value:function(e){this.token=e,this.auth.onAuthStateChanged(this.onAuthStateChanged.bind(this)),this.auth.signInAnonymously().catch(this.error.bind(this))}},{key:"onAuthStateChanged",value:function(e){e&&(this.uid=e.uid,this.findUser())}},{key:"findUser",value:function(){var e=this,t=new Headers({Authorization:"Basic "+WP_REGISTER_SERVICE_WORKER.base64});fetch(WP_REGISTER_SERVICE_WORKER.root+"wp/v2/pwa_users?status=draft&search="+this.uid,{headers:t}).then(function(e){return e.json()}).then(function(t){var n=null;t.length&&(n=t.pop().id),e.saveUser(n)})}},{key:"saveUser",value:function(e){if(WP_REGISTER_SERVICE_WORKER.debug&&"granted"===this.permission){var t=new FormData;t.append("permission","granted"),t.append("uid",this.uid),t.append("pwa_user_id",e),t.append("token",this.token),this.logger.logging(t)}if(this.refresh){var n=new FormData;n.append("msg","RefreshData"),n.append("uid",this.uid),n.append("pwa_user_id",e),n.append("token",this.token),this.logger.logging(n)}var i=new Headers({Authorization:"Basic "+WP_REGISTER_SERVICE_WORKER.base64}),r=new FormData,s=WP_REGISTER_SERVICE_WORKER.root+"wp/v2/pwa_users";e&&(s+="/"+e),r.set("title",this.uid),r.set("token",this.token),fetch(s,{method:"POST",headers:i,body:r})}},{key:"error",value:function(e){console.warn(e)}}]),e}())},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function e(t){i(this,e),this.endpoint=t}return r(e,[{key:"logging",value:function(e){var t=this.createData(e);fetch(this.endpoint,{method:"POST",body:t})}},{key:"createData",value:function(e){var t=new FormData;if(e instanceof FormData==!1){for(var n in e)t.append(n,e[n]);return t}return e}}]),e}();t.default=s}]);