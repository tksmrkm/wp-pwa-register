!function(e){function n(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}var t={};n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=1)}([,function(e,n,t){"use strict";function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();new(function(){function e(){o(this,e),console.count("constructor"),this.messaging=firebase.messaging(),this.auth=firebase.auth(),window.addEventListener("load",this.onload.bind(this))}return s(e,[{key:"onload",value:function(){console.count("onload"),navigator.serviceWorker.register("/pwa-service-worker.js").then(this.register.bind(this))}},{key:"register",value:function(e){console.count("register"),this.messaging.useServiceWorker(e);var n=this.messaging.getNotificationPermission_();console.log(n),"default"===n&&this.requestPermission()}},{key:"requestPermission",value:function(){console.count("requestPermission"),this.messaging.requestPermission().then(this.getToken.bind(this)).catch(this.error.bind(this))}},{key:"getToken",value:function(){console.count("getToken"),this.messaging.getToken().then(this.setToken.bind(this)).catch(this.error.bind(this))}},{key:"setToken",value:function(e){console.count("setToken"),console.log(e),this.token=e,this.auth.onAuthStateChanged(this.onAuthStateChanged.bind(this)),this.auth.signInAnonymously().catch(this.error.bind(this))}},{key:"onAuthStateChanged",value:function(e){console.count("onAuthStateChanged"),e&&(console.log(e),this.uid=e.uid,this.findUser())}},{key:"findUser",value:function(){var e=this;console.count("findUser");var n=ajaxurl.split("/wp-admin/")[0],t=new Headers({Authorization:"Basic "+WP_REGISTER_SERVICE_WORKER.base64});fetch(n+"/wp-json/wp/v2/pwa_users?status=draft&search="+this.uid,{headers:t}).then(function(e){return e.json()}).then(function(n){var t=null;n.length&&(t=n.pop().id),e.saveUser(t)})}},{key:"saveUser",value:function(e){console.count("saveUser"),console.log(e);var n=ajaxurl.split("/wp-admin/")[0],t=new Headers({Authorization:"Basic "+WP_REGISTER_SERVICE_WORKER.base64}),o=new FormData,s=n+"/wp-json/wp/v2/pwa_users";e&&(s+="/"+e),o.set("title",this.uid),o.set("token",this.token),fetch(s,{method:"POST",headers:t,body:o})}},{key:"error",value:function(e){console.warn(e)}}]),e}())}]);